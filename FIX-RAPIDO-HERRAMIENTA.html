<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üîß Fix R√°pido - Error Focusable</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      max-width: 800px;
      width: 100%;
      padding: 40px;
    }

    h1 {
      color: #667eea;
      margin-bottom: 10px;
      font-size: 32px;
    }

    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 16px;
    }

    .alert {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 15px;
      margin-bottom: 30px;
      border-radius: 8px;
    }

    .alert-danger {
      background: #f8d7da;
      border-left-color: #dc3545;
    }

    .alert-success {
      background: #d4edda;
      border-left-color: #28a745;
    }

    .section {
      margin-bottom: 30px;
    }

    .section-title {
      font-size: 20px;
      font-weight: 600;
      color: #333;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
      margin-bottom: 10px;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn-secondary {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      box-shadow: 0 4px 15px rgba(245, 87, 108, 0.4);
    }

    .btn-success {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      box-shadow: 0 4px 15px rgba(79, 172, 254, 0.4);
    }

    .output {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 15px;
      margin-top: 15px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      max-height: 300px;
      overflow-y: auto;
      display: none;
    }

    .output.show {
      display: block;
    }

    .code {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      overflow-x: auto;
    }

    .step {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 10px;
      border-left: 4px solid #667eea;
    }

    .step-number {
      display: inline-block;
      background: #667eea;
      color: white;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      text-align: center;
      line-height: 30px;
      font-weight: 600;
      margin-right: 10px;
    }

    .icon {
      font-size: 24px;
    }

    .success-msg {
      color: #28a745;
      font-weight: 600;
      padding: 10px;
      background: #d4edda;
      border-radius: 8px;
      margin-top: 10px;
      display: none;
    }

    .success-msg.show {
      display: block;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîß Herramienta de Fix R√°pido</h1>
    <p class="subtitle">Soluciona el error "An invalid form control is not focusable"</p>

    <div class="alert alert-danger">
      <strong>‚ö†Ô∏è ERROR IDENTIFICADO:</strong><br>
      Campos <code>required</code> que est√°n ocultos por custom dropdowns bloquean la aplicaci√≥n de datos.
    </div>

    <!-- SECCI√ìN 1: Fix Inmediato -->
    <div class="section">
      <h2 class="section-title">
        <span class="icon">‚ö°</span>
        Soluci√≥n Inmediata (2 minutos)
      </h2>

      <div class="step">
        <span class="step-number">1</span>
        Abre Financia Suite en otra pesta√±a (mant√©n esta pesta√±a abierta)
      </div>

      <div class="step">
        <span class="step-number">2</span>
        En Financia Suite, presiona <kbd>F12</kbd> para abrir DevTools
      </div>

      <div class="step">
        <span class="step-number">3</span>
        Haz clic en este bot√≥n y luego pega el c√≥digo en la consola:
      </div>

      <button class="btn" onclick="copyFixCode()">
        üìã Copiar C√≥digo de Fix Temporal
      </button>

      <div class="code" id="fixCode" style="display:none;">
(function() {
  const form = document.getElementById('expenseForm');
  if (!form) {
    alert('‚ùå Formulario no encontrado. ¬øEst√°s en la p√°gina correcta?');
    return;
  }

  let fixed = 0;
  const requiredInputs = form.querySelectorAll('[required]');
  requiredInputs.forEach(input => {
    if (input.offsetParent === null || window.getComputedStyle(input).display === 'none') {
      input.removeAttribute('required');
      console.log('‚úÖ Required removido de:', input.id || input.name);
      fixed++;
    }
  });

  if (fixed > 0) {
    alert(`‚úÖ Fix aplicado exitosamente!\n\n${fixed} campos corregidos.\n\nAhora intenta aplicar los datos del recibo.`);
  } else {
    alert('‚ÑπÔ∏è No se encontraron campos ocultos con required.\nEl problema puede estar en otro lugar.');
  }
})();
      </div>

      <div class="success-msg" id="copySuccess">
        ‚úÖ ¬°C√≥digo copiado! Ahora p√©galo en la consola de Financia Suite (Ctrl+V) y presiona Enter.
      </div>
    </div>

    <!-- SECCI√ìN 2: Debugging -->
    <div class="section">
      <h2 class="section-title">
        <span class="icon">üîç</span>
        Identificar el Problema
      </h2>

      <p style="margin-bottom: 15px;">
        Este script analizar√° todos los campos y te dir√° exactamente cu√°l est√° causando el problema:
      </p>

      <button class="btn btn-secondary" onclick="copyDebugCode()">
        üìä Copiar Script de Debugging
      </button>

      <div class="success-msg" id="debugSuccess">
        ‚úÖ ¬°C√≥digo de debugging copiado! P√©galo en la consola para ver el reporte completo.
      </div>
    </div>

    <!-- SECCI√ìN 3: Instrucciones -->
    <div class="section">
      <h2 class="section-title">
        <span class="icon">üìö</span>
        Soluci√≥n Permanente
      </h2>

      <div class="alert alert-success">
        <strong>‚úÖ PR√ìXIMOS PASOS:</strong><br>
        1. Abre el archivo <code>FIX-URGENTE-applyDataToForm.js</code><br>
        2. Copia TODO su contenido<br>
        3. En <code>app.js</code>, reemplaza la funci√≥n <code>applyDataToForm()</code> (l√≠nea ~19829)<br>
        4. Guarda y recarga la app con Ctrl+F5
      </div>

      <button class="btn btn-success" onclick="openInstructions()">
        üìñ Ver Instrucciones Completas
      </button>
    </div>

    <!-- SECCI√ìN 4: Testing -->
    <div class="section">
      <h2 class="section-title">
        <span class="icon">üß™</span>
        Verificar que Funcion√≥
      </h2>

      <p style="margin-bottom: 15px;">
        Despu√©s de aplicar el fix, ejecuta este c√≥digo para verificar:
      </p>

      <button class="btn" onclick="copyTestCode()">
        üß™ Copiar C√≥digo de Verificaci√≥n
      </button>

      <div class="success-msg" id="testSuccess">
        ‚úÖ ¬°C√≥digo de verificaci√≥n copiado! Ejec√∫talo despu√©s de aplicar el fix.
      </div>
    </div>
  </div>

  <script>
    function copyFixCode() {
      const code = document.getElementById('fixCode').textContent;
      navigator.clipboard.writeText(code).then(() => {
        document.getElementById('copySuccess').classList.add('show');
        setTimeout(() => {
          document.getElementById('copySuccess').classList.remove('show');
        }, 5000);
      });
    }

    function copyDebugCode() {
      const code = `
(function() {
  console.log('üîç INICIANDO AN√ÅLISIS DE CAMPOS REQUIRED...\\n');

  const form = document.getElementById('expenseForm');
  if (!form) {
    console.error('‚ùå No se encontr√≥ el formulario expenseForm');
    return;
  }

  const requiredInputs = form.querySelectorAll('[required]');
  console.log(\`üìã Total de campos required encontrados: \${requiredInputs.length}\\n\`);

  const problematicFields = [];
  const okFields = [];

  requiredInputs.forEach((input, index) => {
    const fieldInfo = {
      index: index + 1,
      id: input.id || '(sin id)',
      name: input.name || '(sin name)',
      type: input.type || input.tagName.toLowerCase(),
      value: input.value || '(vac√≠o)',
      visible: input.offsetParent !== null,
      display: window.getComputedStyle(input).display,
      visibility: window.getComputedStyle(input).visibility
    };

    const isProblematic = (
      !fieldInfo.visible ||
      fieldInfo.display === 'none' ||
      fieldInfo.visibility === 'hidden' ||
      (!fieldInfo.value && fieldInfo.id !== 'amount')
    );

    if (isProblematic) {
      problematicFields.push(fieldInfo);
    } else {
      okFields.push(fieldInfo);
    }
  });

  console.log('‚úÖ CAMPOS REQUIRED SIN PROBLEMAS:');
  console.table(okFields);

  if (problematicFields.length > 0) {
    console.log('\\n‚ùå CAMPOS REQUIRED PROBLEM√ÅTICOS:');
    console.table(problematicFields);
  } else {
    console.log('\\nüéâ NO SE ENCONTRARON CAMPOS PROBLEM√ÅTICOS');
  }

  console.log('\\nüìä RESUMEN:');
  console.log(\`- Campos OK: \${okFields.length}\`);
  console.log(\`- Campos problem√°ticos: \${problematicFields.length}\`);
  console.log(\`- Total: \${requiredInputs.length}\`);
})();
      `;

      navigator.clipboard.writeText(code).then(() => {
        document.getElementById('debugSuccess').classList.add('show');
        setTimeout(() => {
          document.getElementById('debugSuccess').classList.remove('show');
        }, 5000);
      });
    }

    function copyTestCode() {
      const code = `
// Verificar que el fix funcion√≥
console.log('üß™ VERIFICANDO FIX...');

const form = document.getElementById('expenseForm');
if (!form) {
  console.error('‚ùå Formulario no encontrado');
} else {
  const requiredCount = form.querySelectorAll('[required]').length;
  const hiddenRequired = Array.from(form.querySelectorAll('[required]')).filter(
    input => input.offsetParent === null
  );

  console.log(\`üìä Total campos required: \${requiredCount}\`);
  console.log(\`‚ùå Campos required ocultos: \${hiddenRequired.length}\`);

  if (hiddenRequired.length === 0) {
    console.log('\\n‚úÖ ¬°PERFECTO! No hay campos required ocultos.');
    console.log('El fix deber√≠a funcionar correctamente ahora.');
  } else {
    console.log('\\n‚ö†Ô∏è Todav√≠a hay campos required ocultos:');
    console.table(hiddenRequired.map(i => ({
      id: i.id,
      name: i.name,
      type: i.type
    })));
  }
}
      `;

      navigator.clipboard.writeText(code).then(() => {
        document.getElementById('testSuccess').classList.add('show');
        setTimeout(() => {
          document.getElementById('testSuccess').classList.remove('show');
        }, 5000);
      });
    }

    function openInstructions() {
      // Intentar abrir el archivo de instrucciones
      window.open('SOLUCION-URGENTE-ERROR-FOCUSABLE.md', '_blank');
    }
  </script>
</body>
</html>
