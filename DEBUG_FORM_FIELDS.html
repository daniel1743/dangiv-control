<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Campos de Formulario de Gastos</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .debug-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        button {
            background: #21808D;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1D7480;
        }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üîç Debug - Campos del Formulario de Gastos</h1>

    <div class="debug-section">
        <h2>1. Verificaci√≥n de Elementos HTML</h2>
        <div id="htmlCheck"></div>
    </div>

    <div class="debug-section">
        <h2>2. Verificaci√≥n de CSS</h2>
        <div id="cssCheck"></div>
    </div>

    <div class="debug-section">
        <h2>3. Verificaci√≥n de JavaScript</h2>
        <div id="jsCheck"></div>
    </div>

    <div class="debug-section">
        <h2>4. Triggers de Modales</h2>
        <div id="triggerCheck"></div>
    </div>

    <div class="debug-section">
        <h2>5. Acciones R√°pidas</h2>
        <button onclick="showAllFields()">Mostrar TODOS los campos</button>
        <button onclick="resetForm()">Resetear Formulario</button>
        <button onclick="checkModals()">Verificar Modales</button>
        <button onclick="window.location.href='index.html'">Ir a la App</button>
    </div>

    <script>
        // Ejecutar al cargar
        window.addEventListener('DOMContentLoaded', () => {
            runDiagnostics();
        });

        function runDiagnostics() {
            checkHTML();
            checkCSS();
            checkJavaScript();
            checkTriggers();
        }

        function checkHTML() {
            const container = document.getElementById('htmlCheck');
            let html = '';

            // Verificar campos principales
            const fields = [
                { id: 'category', name: 'Categor√≠a' },
                { id: 'necessity', name: 'Necesidad/Prioridad' },
                { id: 'user', name: 'Usuario' },
                { id: 'date', name: 'Fecha' },
                { id: 'categoryTriggerContainer', name: 'Contenedor Trigger Categor√≠a' },
                { id: 'necessityTriggerContainer', name: 'Contenedor Trigger Necesidad' }
            ];

            fields.forEach(field => {
                const element = parent.document.getElementById(field.id);
                const exists = element !== null;
                const visible = exists && element.offsetParent !== null;

                html += `
                    <div class="status ${exists ? (visible ? 'success' : 'warning') : 'error'}">
                        <strong>${field.name}</strong> (${field.id})<br>
                        ‚úì Existe: ${exists ? 'S√ç' : 'NO'}<br>
                        ${exists ? `‚úì Visible: ${visible ? 'S√ç' : 'NO (oculto con CSS)'}` : ''}
                        ${exists && !visible ? `<br>‚ö†Ô∏è display: ${getComputedStyle(element).display}` : ''}
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function checkCSS() {
            const container = document.getElementById('cssCheck');
            const formGrids = parent.document.querySelectorAll('.form-grid-2');

            let html = `<p><strong>Form Grids encontrados:</strong> ${formGrids.length}</p>`;

            formGrids.forEach((grid, index) => {
                const styles = getComputedStyle(grid);
                const isVisible = grid.offsetParent !== null;

                html += `
                    <div class="status ${isVisible ? 'success' : 'error'}">
                        <strong>Form Grid ${index + 1}</strong><br>
                        Display: ${styles.display}<br>
                        Visibility: ${styles.visibility}<br>
                        Opacity: ${styles.opacity}<br>
                        Visible: ${isVisible ? 'S√ç' : 'NO'}
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function checkJavaScript() {
            const container = document.getElementById('jsCheck');
            let html = '';

            // Verificar si window.app existe
            const appExists = parent.window.app !== undefined;
            html += `
                <div class="status ${appExists ? 'success' : 'error'}">
                    <strong>window.app:</strong> ${appExists ? 'Existe ‚úì' : 'No existe ‚úó'}
                </div>
            `;

            if (appExists) {
                const methods = [
                    'initSelectModals',
                    'setupSelectModalTriggers',
                    'createModalTrigger'
                ];

                methods.forEach(method => {
                    const exists = typeof parent.window.app[method] === 'function';
                    html += `
                        <div class="status ${exists ? 'success' : 'error'}">
                            <strong>${method}:</strong> ${exists ? 'Existe ‚úì' : 'No existe ‚úó'}
                        </div>
                    `;
                });
            }

            container.innerHTML = html;
        }

        function checkTriggers() {
            const container = document.getElementById('triggerCheck');

            const categoryContainer = parent.document.getElementById('categoryTriggerContainer');
            const necessityContainer = parent.document.getElementById('necessityTriggerContainer');

            let html = '';

            if (categoryContainer) {
                html += `
                    <div class="status ${categoryContainer.children.length > 0 ? 'success' : 'warning'}">
                        <strong>categoryTriggerContainer</strong><br>
                        Hijos: ${categoryContainer.children.length}<br>
                        ${categoryContainer.children.length === 0 ? '‚ö†Ô∏è VAC√çO - El trigger no se cre√≥' : '‚úì Trigger creado'}
                    </div>
                `;
            }

            if (necessityContainer) {
                html += `
                    <div class="status ${necessityContainer.children.length > 0 ? 'success' : 'warning'}">
                        <strong>necessityTriggerContainer</strong><br>
                        Hijos: ${necessityContainer.children.length}<br>
                        ${necessityContainer.children.length === 0 ? '‚ö†Ô∏è VAC√çO - El trigger no se cre√≥' : '‚úì Trigger creado'}
                    </div>
                `;
            }

            container.innerHTML = html || '<p class="error">No se encontraron contenedores</p>';
        }

        function showAllFields() {
            // Forzar visibilidad de todos los campos
            const formGrids = parent.document.querySelectorAll('.form-grid-2');
            formGrids.forEach(grid => {
                grid.style.display = 'grid';
                grid.style.visibility = 'visible';
                grid.style.opacity = '1';
            });

            const formGroups = parent.document.querySelectorAll('.form-group-premium');
            formGroups.forEach(group => {
                group.style.display = 'block';
                group.style.visibility = 'visible';
                group.style.opacity = '1';
            });

            alert('‚úì Se forz√≥ la visibilidad de todos los campos. Recarga la p√°gina para volver al estado normal.');
            runDiagnostics();
        }

        function resetForm() {
            if (parent.window.app && typeof parent.window.app.initSelectModals === 'function') {
                parent.window.app.initSelectModals();
                alert('‚úì Se reinici√≥ el sistema de modales');
                runDiagnostics();
            } else {
                alert('‚úó No se pudo acceder a window.app.initSelectModals()');
            }
        }

        function checkModals() {
            const modals = ['categoryModal', 'necessityModal', 'userModal'];
            let html = '<h3>Modales de Selecci√≥n:</h3>';

            modals.forEach(id => {
                const modal = parent.document.getElementById(id);
                html += `
                    <div class="status ${modal ? 'success' : 'error'}">
                        <strong>${id}:</strong> ${modal ? 'Existe ‚úì' : 'No existe ‚úó'}
                    </div>
                `;
            });

            document.getElementById('triggerCheck').innerHTML += html;
        }
    </script>
</body>
</html>
